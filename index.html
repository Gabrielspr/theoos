<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />
  <title>TheoOS Pro 3.1 (Green Edition)</title>
  <style>
    /* --- DESIGN SYSTEM PRO: GREEN EDITION --- */
    :root {
      /* Day Theme (Natureza) */
      --bg-grad: radial-gradient(1200px 700px at 60% 110%, #b8f7c3 0%, #a8e9f0 55%, #c9d8ff 100%); /* Original restaurado como base */
      --win-bg: rgba(255, 255, 255, 0.85);
      --text: #2d3436;
      --accent: #00b894; /* Verde Menta */
      --glass-border: rgba(255, 255, 255, 0.6);
      
      /* Night Theme (Floresta Noturna) */
      --bg-night-grad: linear-gradient(to bottom, #093028, #237a57);
      --win-bg-night: rgba(10, 30, 20, 0.9);
      --text-night: #ecf0f1;
      
      /* Specs */
      --radius: 14px;
      --shadow: 0 15px 35px rgba(0,0,0,0.2);
      --font-ui: "Trebuchet MS", "Segoe UI", system-ui, sans-serif;
    }

    * { box-sizing: border-box; user-select: none; -webkit-tap-highlight-color: transparent; }
    body, html { margin: 0; height: 100%; overflow: hidden; font-family: var(--font-ui); color: var(--text); }
    
    body.night-mode { color: var(--text-night); }
    body.night-mode #wallpaper { background: var(--bg-night-grad); } 
    /* Nota: O JS vai sobrescrever o background do wallpaper se o usu√°rio escolher um espec√≠fico */
    
    body.night-mode .window { background: var(--win-bg-night); border-color: #2ecc71; color: var(--text-night); }
    body.night-mode .titlebar { background: rgba(255,255,255,0.05); border-bottom: 1px solid rgba(255,255,255,0.1); }
    body.night-mode .taskbar { background: rgba(5, 20, 10, 0.85); border-top: 1px solid #2ecc71; }
    body.night-mode .start-menu { background: rgba(10, 30, 20, 0.95); color: white; border: 1px solid #2ecc71; }
    body.night-mode input, body.night-mode textarea { color: white; background: rgba(0,0,0,0.3); border-color: #2ecc71; }
    body.night-mode .btn { background: #27ae60; }

    /* --- LAYOUT --- */
    #wallpaper { 
        position: fixed; inset: 0; z-index: -1; 
        background: var(--bg-grad); 
        transition: background-image 0.5s ease-in-out; 
        background-size: cover;
        background-position: center;
    }

    /* Clouds (Do original) */
    .cloud { position: absolute; filter: blur(3px); opacity: 0.4; animation: floatCloud 60s linear infinite; }
    .cloud::before { content:""; display:block; width:220px; height:90px; border-radius:60px; background:white; box-shadow: 80px -20px 0 10px white, 150px 0 0 0 white, 40px 10px 0 -10px white; }
    @keyframes floatCloud { from { transform: translateX(-100vw); } to { transform: translateX(100vw); } }

    /* Boot Screen */
    #boot-screen { position: fixed; inset: 0; z-index: 20000; background: black; display: flex; flex-direction: column; align-items: center; justify-content: center; }
    #boot-video { position: absolute; inset: 0; width: 100%; height: 100%; object-fit: cover; z-index: 1; display: none; }
    #power-btn { z-index: 2; padding: 15px 30px; font-size: 1.2rem; border-radius: 50px; border: none; background: #00b894; color: white; cursor: pointer; box-shadow: 0 0 20px rgba(0, 184, 148, 0.6); transition: transform 0.2s; display: flex; align-items: center; gap: 10px; }
    #power-btn:hover { transform: scale(1.05); background: #55efc4; color: #006266; }

    /* Login Ritual */
    #login-ritual { position: fixed; inset: 0; z-index: 10000; background: rgba(0,0,0,0.6); backdrop-filter: blur(20px); display: none; place-items: center; transition: opacity 0.8s; color: white; }
    .heart-core { font-size: 5rem; cursor: pointer; animation: pulse 1.5s infinite; filter: drop-shadow(0 0 20px rgba(0, 255, 127, 0.6)); transition: transform 0.2s; }
    .heart-core:hover { transform: scale(1.1); }
    @keyframes pulse { 0% { transform: scale(1); } 50% { transform: scale(1.1); } 100% { transform: scale(1); } }
    .login-input { background: transparent; border: 0; border-bottom: 2px solid rgba(255,255,255,0.5); color: white; font-size: 1.5rem; text-align: center; padding: 10px; outline: none; margin-top: 20px; width: 200px; }

    /* Desktop */
    #desktop { position: absolute; inset: 0; display: none; }
    
    /* Icons */
    .icons-area { padding: 20px; display: grid; grid-template-columns: repeat(auto-fill, minmax(80px, 1fr)); gap: 20px; max-width: 600px; }
    .app-icon { display: flex; flex-direction: column; align-items: center; cursor: pointer; color: white; text-shadow: 0 2px 4px rgba(0,0,0,0.5); gap: 5px; transition: transform 0.2s; }
    .app-icon:hover { transform: translateY(-5px); }
    .app-icon-bg { width: 58px; height: 58px; background: rgba(255,255,255,0.2); border-radius: 16px; display: grid; place-items: center; font-size: 28px; backdrop-filter: blur(8px); border: 1px solid rgba(255,255,255,0.3); box-shadow: 0 4px 10px rgba(0,0,0,0.1); }

    /* Windows */
    .window { position: absolute; background: var(--win-bg); border-radius: var(--radius); box-shadow: var(--shadow); backdrop-filter: blur(12px); border: 1px solid var(--glass-border); display: flex; flex-direction: column; min-width: 300px; min-height: 200px; overflow: hidden; opacity: 0; transform: scale(0.9); pointer-events: none; transition: opacity 0.2s, transform 0.2s; }
    .window.open { opacity: 1; transform: scale(1); pointer-events: auto; }
    .window.minimized { opacity: 0; transform: translateY(50px) scale(0.8); pointer-events: none; }
    .titlebar { height: 40px; display: flex; align-items: center; padding: 0 12px; background: rgba(0,0,0,0.03); border-bottom: 1px solid rgba(0,0,0,0.05); cursor: move; justify-content: space-between; }
    .win-title { font-weight: 600; font-size: 14px; display: flex; align-items: center; gap: 8px; }
    .win-controls button { width: 12px; height: 12px; border-radius: 50%; border: none; margin-left: 6px; cursor: pointer; }
    .btn-close { background: #ff5f56; } .btn-min { background: #ffbd2e; } .btn-max { background: #27c93f; }
    .win-body { flex: 1; overflow: auto; padding: 15px; position: relative; }

    /* Taskbar */
    .taskbar { position: absolute; bottom: 0; width: 100%; height: 50px; background: rgba(255,255,255,0.5); backdrop-filter: blur(20px); display: flex; align-items: center; padding: 0 10px; z-index: 1000; border-top: 1px solid rgba(255,255,255,0.4); }
    .start-btn { background: rgba(255,255,255,0.8); border: none; padding: 8px 16px; border-radius: 10px; font-weight: bold; cursor: pointer; color: #00b894; box-shadow: 0 2px 5px rgba(0,0,0,0.1); display:flex; align-items:center; gap:6px; margin-right: 10px;}
    .start-btn:hover { background: white; }
    .task-list { display: flex; gap: 6px; overflow-x: auto; flex: 1; }
    .task-item { padding: 8px 14px; background: rgba(255,255,255,0.4); border-radius: 10px; font-size: 13px; cursor: pointer; white-space: nowrap; transition: 0.2s; border: 1px solid transparent; }
    .task-item.active { background: white; border-color: var(--accent); color: var(--accent); font-weight: 500; }
    .clock { margin-left: auto; font-variant-numeric: tabular-nums; font-size: 14px; font-weight: 600; color: #2d3436; }
    .night-mode .clock { color: white; }

    /* Start Menu */
    .start-menu { position: absolute; bottom: 60px; left: 10px; width: 280px; background: rgba(255,255,255,0.9); backdrop-filter: blur(20px); border-radius: 16px; padding: 10px; display: none; flex-direction: column; gap: 4px; box-shadow: var(--shadow); z-index: 1001; }
    .start-item { padding: 12px; border-radius: 10px; cursor: pointer; display: flex; align-items: center; gap: 12px; font-size: 14px; transition: background 0.1s; }
    .start-item:hover { background: rgba(0,184,148,0.1); color: var(--accent); }

    /* --- APP SPECIFIC STYLES --- */
    .btn { padding: 8px 16px; border-radius: 8px; border: none; background: var(--accent); color: white; cursor: pointer; transition: 0.2s; font-weight: 500; }
    .btn:hover { opacity: 0.9; transform: translateY(-1px); }
    textarea, input[type="text"] { width: 100%; border: 1px solid rgba(0,0,0,0.1); border-radius: 8px; padding: 10px; font-family: inherit; background: rgba(255,255,255,0.6); outline: none; }
    textarea:focus, input[type="text"]:focus { background: white; border-color: var(--accent); }
    
    /* Game Fix */
    #game-area { width: 100%; height: 100%; background: linear-gradient(to top, #00b894 0%, #55efc4 100%); border-radius: 8px; position: relative; overflow: hidden; cursor: crosshair; }
    .game-heart { 
        position: absolute; 
        font-size: 32px; /* Bigger hearts */
        user-select: none; 
        animation: floatUp 3s linear forwards; 
        cursor: pointer; 
        z-index: 10;
        filter: drop-shadow(0 2px 4px rgba(0,0,0,0.2));
    }
    .game-heart:active { transform: scale(1.5); }
    @keyframes floatUp { 
        0% { transform: translateY(0) scale(0.5); opacity: 0; top: 100%; } 
        10% { opacity: 1; transform: scale(1); } 
        100% { transform: translateY(-400px) scale(1.2); opacity: 0; top: 100%; } 
    }

    /* Paint */
    .paint-tools { display: flex; gap: 5px; margin-bottom: 10px; flex-wrap: wrap; }
    .color-swatch { width: 24px; height: 24px; border-radius: 50%; cursor: pointer; border: 2px solid white; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
    .color-swatch.active { transform: scale(1.2); box-shadow: 0 0 0 2px var(--accent); }
    #paint-canvas { background: white; border-radius: 8px; cursor: crosshair; touch-action: none; box-shadow: inset 0 2px 5px rgba(0,0,0,0.05); width: 100%; height: 300px; }

    /* Calculator */
    .calc-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 8px; height: 100%; }
    .calc-display { grid-column: 1/-1; background: rgba(0,0,0,0.05); padding: 15px; border-radius: 8px; text-align: right; font-size: 24px; font-family: monospace; margin-bottom: 5px; color: var(--accent); font-weight: bold; }
    .calc-btn { border: none; border-radius: 8px; background: rgba(255,255,255,0.6); font-size: 18px; cursor: pointer; transition: 0.1s; }
    .calc-btn:hover { background: white; }
    .calc-btn.op { background: rgba(0, 184, 148, 0.1); color: var(--accent); }
    .calc-btn.eq { background: var(--accent); color: white; }

    /* Gallery */
    .gallery-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(90px, 1fr)); gap: 10px; }
    .gallery-item { position: relative; aspect-ratio: 1; overflow: hidden; border-radius: 8px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); cursor: pointer; }
    .gallery-item img { width: 100%; height: 100%; object-fit: cover; transition: transform 0.3s; }
    .gallery-item:hover img { transform: scale(1.1); }
    
    /* Terminal */
    .terminal { font-family: "Fira Code", monospace; font-size: 13px; color: #333; height: 100%; overflow-y: auto; }
    .night-mode .terminal { color: #55efc4; }
    .prompt { color: var(--accent); font-weight: bold; margin-right: 5px; }

    /* Zen */
    .zen-circle { width: 120px; height: 120px; border-radius: 50%; background: conic-gradient(from 0deg, #55efc4, #00b894, #55efc4); margin: 40px auto; animation: spinBreath 6s linear infinite; display: grid; place-items: center; color: white; font-size: 12px; box-shadow: 0 0 30px rgba(85, 239, 196, 0.4); }
    @keyframes spinBreath { 0% { transform: rotate(0deg) scale(0.8); } 50% { transform: rotate(180deg) scale(1.2); } 100% { transform: rotate(360deg) scale(0.8); } }

  </style>
</head>
<body>

  <!-- ASSETS -->
  <audio id="startupSound" src="ini.mp3"></audio>
  <audio id="sfx-open" src="open.mp3"></audio>
  <audio id="sfx-close" src="close.mp3"></audio>
  <audio id="sfx-click" src="click.mp3"></audio>
  <audio id="bgMusicPlayer" loop></audio>

  <!-- BOOT SCREEN -->
  <div id="boot-screen">
    <video id="boot-video" src="boot.mp4" playsinline></video>
    <button id="power-btn" onclick="Boot.start()">
      <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M18.36 6.64a9 9 0 1 1-12.73 0"></path><line x1="12" y1="2" x2="12" y2="12"></line></svg>
      Ligar TheoOS
    </button>
  </div>

  <div id="wallpaper">
      <div class="cloud" style="top:12%;left:8%"></div> 
      <div class="cloud" style="top:24%;left:42%;transform:scale(1.2)"></div> 
      <div class="cloud" style="top:54%;left:18%;transform:scale(1.1)"></div> 
      <div class="cloud" style="top:66%;left:68%;transform:scale(0.9)"></div>
  </div>

  <!-- LOGIN RITUAL -->
  <div id="login-ritual">
    <div style="text-align: center;">
      <div class="heart-core" id="heart-btn">üåø</div>
      <div id="login-msg" style="margin-top: 15px; opacity: 0.8; font-weight: 500;">Bem-vindo ao TheoOS</div>
      <form id="login-form">
        <input type="password" class="login-input" id="pass-input" placeholder="senha (theo)" autocomplete="off">
      </form>
    </div>
  </div>

  <!-- DESKTOP -->
  <div id="desktop">
    <div class="icons-area" id="desktop-icons"></div>

    <!-- JANELAS (APPS) -->
    <div id="windows-container">

        <!-- 1. CHANGELOG -->
        <div class="window" id="win-changelog" style="width: 450px; height: 500px; left: 50px; top: 50px;">
            <div class="titlebar"><div class="win-title">üìú Changelog 3.1</div><div class="win-controls"><button class="btn-close" onclick="closeWin('win-changelog')"></button></div></div>
            <div class="win-body">
                <h3>TheoOS Pro 3.1 ‚Äî Green Edition</h3>
                <ul style="padding-left: 20px; line-height: 1.6;">
                    <li><b>üåø Tema Verde:</b> Interface totalmente renovada com cores da natureza.</li>
                    <li><b>üíæ Conte√∫do Original:</b> M√∫sicas, hist√≥ria e textos restaurados.</li>
                    <li><b>üé¨ Boot Screen:</b> Adicionado suporte a v√≠deo de boot (boot.mp4).</li>
                    <li><b>üéÆ Jogo Corrigido:</b> Catch Hearts agora funciona perfeitamente.</li>
                </ul>
            </div>
        </div>

        <!-- 2. TERMINAL -->
        <div class="window" id="win-term" style="width: 500px; height: 350px;">
            <div class="titlebar"><div class="win-title">üí¨ TheoShell</div><div class="win-controls"><button class="btn-close" onclick="closeWin('win-term')"></button></div></div>
            <div class="win-body terminal" id="term-out" onclick="document.getElementById('term-in').focus()">
                <div>Bem-vindo ao <b>TheoShell 1.0</b> ‚Äî digite <b style="color:var(--accent)">'ajuda'</b>.</div>
                <div style="margin-top:10px; display:flex;"><span class="prompt">‚ûú</span><input id="term-in" style="background:transparent; border:none; padding:0; color:inherit; width:100%; outline:none;" autocomplete="off"></div>
            </div>
        </div>

        <!-- 3. CARTAS (NOTES) -->
        <div class="window" id="win-notes" style="width: 350px; height: 400px;">
            <div class="titlebar"><div class="win-title">üìù Minhas Cartas</div><div class="win-controls"><button class="btn-close" onclick="closeWin('win-notes')"></button></div></div>
            <div class="win-body" style="display:flex; flex-direction:column;">
                <p>Escreva aqui suas cartas. üíå</p>
                <textarea id="notes-area" style="flex:1; resize:none;" placeholder="Escreva seus pensamentos..."></textarea>
                <button onclick="alert('Carta salva! ‚ù§Ô∏è')" class="btn" style="margin-top:10px;width:fit-content">Salvar</button>
            </div>
        </div>

        <!-- 4. GALERIA -->
        <div class="window" id="win-gallery" style="width: 400px; height: 450px;">
            <div class="titlebar"><div class="win-title">üì∏ Fotos e Mem√≥rias</div><div class="win-controls"><button class="btn-close" onclick="closeWin('win-gallery')"></button></div></div>
            <div class="win-body">
                <label for="img-upload" class="btn" style="display:block; text-align:center; margin-bottom:10px;">Adicionar Foto</label>
                <input type="file" id="img-upload" accept="image/*" style="display:none">
                <div class="gallery-grid" id="gallery-grid"></div>
            </div>
        </div>

        <!-- 5. DESENHO (PAINT) -->
        <div class="window" id="win-paint" style="width: 500px; height: 450px;">
            <div class="titlebar"><div class="win-title">üé® Desenho</div><div class="win-controls"><button class="btn-close" onclick="closeWin('win-paint')"></button></div></div>
            <div class="win-body">
                <div class="paint-tools" id="paint-colors"></div>
                <button class="btn" onclick="clearPaint()" style="font-size:12px; padding:4px 8px; margin-bottom:5px;">Limpar</button>
                <canvas id="paint-canvas" width="460" height="300"></canvas>
            </div>
        </div>

        <!-- 6. CALCULADORA -->
        <div class="window" id="win-calc" style="width: 260px; height: 350px;">
            <div class="titlebar"><div class="win-title">üßÆ Calculadora</div><div class="win-controls"><button class="btn-close" onclick="closeWin('win-calc')"></button></div></div>
            <div class="win-body">
                <div class="calc-grid" id="calc-keys">
                    <div class="calc-display" id="calc-disp">0</div>
                    <!-- Keys generated via JS -->
                </div>
            </div>
        </div>

        <!-- 7. JOGO -->
        <div class="window" id="win-game" style="width: 400px; height: 350px;">
            <div class="titlebar"><div class="win-title">üéÆ Colete Cora√ß√µes</div><div class="win-controls"><button class="btn-close" onclick="closeWin('win-game')"></button></div></div>
            <div class="win-body" style="padding:0;">
                <div style="position:absolute; top:10px; left:10px; z-index:20; color:white; font-weight:bold; background:rgba(0,0,0,0.3); padding:4px 8px; border-radius:8px;">Pontua√ß√£o: <span id="game-score">0</span> / 10</div>
                <div id="game-area" onclick="GameApp.clickBg()"></div>
            </div>
        </div>

        <!-- 8. M√öSICA -->
        <div class="window" id="win-music" style="width: 320px; height: 260px;">
            <div class="titlebar"><div class="win-title">üéµ M√∫sica</div><div class="win-controls"><button class="btn-close" onclick="closeWin('win-music')"></button></div></div>
            <div class="win-body" style="text-align:center;">
                <label for="music-upload" class="btn" style="font-size:12px;">Adicionar M√∫sicas</label>
                <input type="file" id="music-upload" accept="audio/*" style="display:none" multiple>
                
                <p style="margin-top:15px; font-size:0.9rem">Tocando:</p>
                <h3 id="music-status" style="margin:5px 0 15px 0;">-- Nenhuma --</h3>
                
                <div style="display:flex; justify-content:center; gap:15px; margin-bottom:15px;">
                    <button class="btn" onclick="MusicApp.prev()">‚èÆ</button>
                    <button class="btn" onclick="MusicApp.playPause()">‚èØ</button>
                    <button class="btn" onclick="MusicApp.next()">‚è≠</button>
                </div>
            </div>
        </div>

        <!-- 9. AVENTURA (RPG) -->
        <div class="window" id="win-adventure" style="width: 500px; height: 400px;">
            <div class="titlebar"><div class="win-title">‚öîÔ∏è Pequenas Aventuras</div><div class="win-controls"><button class="btn-close" onclick="closeWin('win-adventure')"></button></div></div>
            <div class="win-body" style="display:flex; flex-direction:column;">
                <div id="adv-text" style="flex:1; font-size:16px; line-height:1.6; padding:10px;"></div>
                <div id="adv-opts" style="display:flex; flex-direction:column; gap:8px; margin-top:10px;"></div>
            </div>
        </div>

        <!-- 10. ZEN -->
        <div class="window" id="win-zen" style="width: 300px; height: 350px;">
            <div class="titlebar"><div class="win-title">üßò Zen</div><div class="win-controls"><button class="btn-close" onclick="closeWin('win-zen')"></button></div></div>
            <div class="win-body" style="text-align:center;">
                <div class="zen-circle">Inspire</div>
                <p>Sincronize sua respira√ß√£o.<br>Relaxe.</p>
            </div>
        </div>

         <!-- 11. OR√ÅCULO -->
         <div class="window" id="win-oracle" style="width: 300px; height: 250px;">
            <div class="titlebar"><div class="win-title">üîÆ Or√°culo</div><div class="win-controls"><button class="btn-close" onclick="closeWin('win-oracle')"></button></div></div>
            <div class="win-body" style="text-align:center; display:flex; flex-direction:column; justify-content:center;">
                <div id="oracle-res" style="font-size:18px; font-weight:bold; margin-bottom:15px;">O que deseja saber?</div>
                <button class="btn" onclick="OracleApp.ask()">Revelar Destino</button>
            </div>
        </div>

        <!-- 12. DI√ÅRIO DE SONHOS -->
        <div class="window" id="win-dreams" style="width: 350px; height: 400px;">
            <div class="titlebar"><div class="win-title">üåô Sonhos</div><div class="win-controls"><button class="btn-close" onclick="closeWin('win-dreams')"></button></div></div>
            <div class="win-body">
                 <textarea id="dreams-area" style="height:100%; background:rgba(0, 184, 148, 0.1); color:var(--text);" placeholder="Descreva seu sonho..."></textarea>
            </div>
        </div>
        
        <!-- 13. CONFIGURA√á√ïES -->
        <div class="window" id="win-settings" style="width: 350px; height: 300px;">
            <div class="titlebar"><div class="win-title">‚öôÔ∏è Ajustes</div><div class="win-controls"><button class="btn-close" onclick="closeWin('win-settings')"></button></div></div>
            <div class="win-body">
                <p style="font-weight:bold; margin-bottom:5px;">Tema:</p>
                <div style="display:flex; gap:10px; margin-bottom:20px;">
                    <button class="btn" onclick="UI.setTheme('day')">‚òÄÔ∏è Dia</button>
                    <button class="btn" style="background:#2c3e50" onclick="UI.setTheme('night')">üåô Noite</button>
                </div>

                <p style="font-weight:bold; margin-bottom:5px;">Papel de Parede:</p>
                <div style="display:flex; gap:10px; flex-wrap:wrap;">
                    <button class="btn" onclick="UI.setWallpaper('verde_azul')">Verde e Azul (Original)</button>
                    <button class="btn" style="background:#ff9ff3; color:#2d3436;" onclick="UI.setWallpaper('amor_rosa')">Amor Rosa</button>
                    <button class="btn" style="background:#00b894" onclick="UI.setWallpaper('default')">Green Pro</button>
                </div>
                
                <p style="margin-top:20px; font-size:12px; color:gray;">TheoOS v3.1 Pro<br>Heart Kernel Active</p>
            </div>
        </div>
        
        <!-- 14. LEMBRETE -->
        <div class="window" id="win-reminder" style="width: 300px; height: 200px;">
            <div class="titlebar"><div class="win-title">üìå Lembrete</div><div class="win-controls"><button class="btn-close" onclick="closeWin('win-reminder')"></button></div></div>
            <div class="win-body" style="display:grid; place-items:center; text-align:center;">
                <h3 id="reminder-txt">...</h3>
                <button class="btn" onclick="ReminderApp.new()">Outro</button>
            </div>
        </div>
        
        <!-- 15. CONQUISTAS -->
        <div class="window" id="win-achv" style="width: 320px; height: 300px;">
            <div class="titlebar"><div class="win-title">üèÜ Conquistas do Amor</div><div class="win-controls"><button class="btn-close" onclick="closeWin('win-achv')"></button></div></div>
            <div class="win-body">
                <ul id="achv-list" style="padding-left:20px;">
                    <li>üèÖ Primeira risada</li>
                    <li>üì∏ Selfie da semana</li>
                    <li>ü´∂ Abra√ßo de 10s</li>
                </ul>
            </div>
        </div>

    </div>

    <!-- TASKBAR -->
    <div class="taskbar">
        <button class="start-btn" onclick="UI.toggleStart()">‚ùñ Iniciar</button>
        <div class="task-list" id="task-list"></div>
        <div class="clock" id="clock">00:00</div>
    </div>
    
    <div class="start-menu" id="start-menu">
        <div style="padding:10px; font-weight:bold; border-bottom:1px solid #eee; color: var(--accent);">Ol√°, Theo üåø</div>
        <div id="start-items"></div>
    </div>

  </div>

  <script>
    /* --- UTILS --- */
    const $ = s => document.querySelector(s);
    const $$ = s => document.querySelectorAll(s);
    const playSound = (id) => { const el = $(id); if(el) { el.currentTime=0; el.play().catch(()=>{}); }};

    /* --- DATA & KERNEL --- */
    const Apps = [
        { id: 'win-changelog', name: 'Changelog', icon: 'üìú' },
        { id: 'win-notes', name: 'Cartas', icon: 'üìù' },
        { id: 'win-gallery', name: 'Fotos', icon: 'üì∏' },
        { id: 'win-music', name: 'M√∫sica', icon: 'üéµ' },
        { id: 'win-paint', name: 'Desenho', icon: 'üé®' },
        { id: 'win-calc', name: 'Calculadora', icon: 'üßÆ' },
        { id: 'win-term', name: 'Terminal', icon: 'üí¨' },
        { id: 'win-game', name: 'Jogo', icon: 'üéÆ' },
        { id: 'win-adventure', name: 'Aventura', icon: '‚öîÔ∏è' },
        { id: 'win-zen', name: 'Zen', icon: 'üßò' },
        { id: 'win-oracle', name: 'Or√°culo', icon: 'üîÆ' },
        { id: 'win-dreams', name: 'Sonhos', icon: 'üåô' },
        { id: 'win-reminder', name: 'Lembrete', icon: 'üìå' },
        { id: 'win-achv', name: 'Conquistas', icon: 'üèÜ' },
        { id: 'win-settings', name: 'Ajustes', icon: '‚öôÔ∏è' }
    ];

    const Kernel = {
        data: { boots: 0, theme: 'auto', wallpaper: 'default', notes: '', dreams: '', photos: [] },
        init() {
            const saved = localStorage.getItem('theoos_pro_31');
            if (saved) this.data = { ...this.data, ...JSON.parse(saved) };
            
            // Tenta importar fotos antigas se existirem
            const oldPhotos = localStorage.getItem('theoos-photos');
            if(oldPhotos && this.data.photos.length === 0) {
                 this.data.photos = JSON.parse(oldPhotos).map(p => p.src);
            }

            this.data.boots++;
            this.save();
            this.applyTheme();
            this.applyWallpaper();
        },
        save() { localStorage.setItem('theoos_pro_31', JSON.stringify(this.data)); },
        applyTheme() {
            const h = new Date().getHours();
            const isNight = this.data.theme === 'night' || (this.data.theme === 'auto' && (h >= 22 || h < 5));
            document.body.classList.toggle('night-mode', isNight);
        },
        applyWallpaper() {
             const wp = this.data.wallpaper;
             const el = $('#wallpaper');
             if(wp === 'verde_azul') el.style.background = 'radial-gradient(1200px 700px at 60% 110%, #b8f7c3 0%, #a8e9f0 55%, #c9d8ff 100%)';
             else if(wp === 'amor_rosa') el.style.background = 'url("wallpaper2.jpg") center/cover';
             else el.style.background = 'var(--bg-grad)';
        }
    };

    /* --- BOOT LOGIC --- */
    const Boot = {
        start() {
            const btn = $('#power-btn');
            const video = $('#boot-video');
            btn.style.display = 'none';
            video.style.display = 'block';
            
            video.play().then(() => {
                video.onended = () => this.end();
            }).catch(() => {
                // Se o v√≠deo falhar, vai direto para o login
                setTimeout(() => this.end(), 1000);
            });
        },
        end() {
            const screen = $('#boot-screen');
            screen.style.transition = 'opacity 1s';
            screen.style.opacity = '0';
            setTimeout(() => {
                screen.style.display = 'none';
                $('#login-ritual').style.display = 'grid'; 
                playSound('#startupSound');
                MusicApp.startBackground(); // Inicia m√∫sica de fundo
            }, 1000);
        }
    };

    /* --- UI ENGINE --- */
    const UI = {
        zTop: 100,
        
        init() {
            this.renderIcons();
            this.renderStart();
            setInterval(() => $('#clock').innerText = new Date().toLocaleTimeString([], {hour:'2-digit', minute:'2-digit'}), 1000);
            this.dragLogic();
        },

        renderIcons() {
            const area = $('#desktop-icons');
            Apps.forEach(app => {
                const div = document.createElement('div');
                div.className = 'app-icon';
                div.innerHTML = `<div class="app-icon-bg">${app.icon}</div><span>${app.name}</span>`;
                div.onclick = () => this.openWin(app.id);
                area.appendChild(div);
            });
        },

        renderStart() {
            const menu = $('#start-items');
            Apps.forEach(app => {
                const div = document.createElement('div');
                div.className = 'start-item';
                div.innerHTML = `<span>${app.icon}</span> ${app.name}`;
                div.onclick = () => { this.openWin(app.id); this.toggleStart(); };
                menu.appendChild(div);
            });
        },

        openWin(id) {
            const win = $('#' + id);
            if (!win) return;
            win.style.display = 'flex';
            setTimeout(() => { win.classList.add('open'); win.classList.remove('minimized'); }, 10);
            this.focusWin(win);
            this.updateTaskbar();
            playSound('#sfx-open');
            
            if(id === 'win-game') GameApp.start();
            if(id === 'win-adventure') AdvApp.render('start');
            if(id === 'win-paint') PaintApp.init();
            if(id === 'win-calc') CalcApp.init();
            if(id === 'win-gallery') GalleryApp.render();
            if(id === 'win-reminder') ReminderApp.new();
        },

        closeWin(id) {
            const win = $('#' + id);
            win.classList.remove('open');
            setTimeout(() => { win.style.display = 'none'; this.updateTaskbar(); }, 200);
            playSound('#sfx-close');
            if(id === 'win-game') GameApp.stop();
        },

        focusWin(win) {
            this.zTop++;
            win.style.zIndex = this.zTop;
            this.updateTaskbar();
        },

        updateTaskbar() {
            const bar = $('#task-list');
            bar.innerHTML = '';
            $$('.window').forEach(win => {
                if (win.style.display === 'none') return;
                const app = Apps.find(a => a.id === win.id);
                const item = document.createElement('div');
                item.className = `task-item ${win.style.zIndex == this.zTop && !win.classList.contains('minimized') ? 'active' : ''}`;
                item.innerText = app ? app.name : 'Janela';
                item.onclick = () => {
                    if (win.classList.contains('minimized') || win.style.zIndex != this.zTop) {
                        win.classList.remove('minimized');
                        this.focusWin(win);
                    } else {
                        win.classList.add('minimized');
                        item.classList.remove('active');
                    }
                };
                bar.appendChild(item);
            });
        },

        toggleStart() {
            const menu = $('#start-menu');
            if(menu.style.display === 'flex') {
                 menu.style.display = 'none';
            } else {
                 menu.style.display = 'flex';
                 playSound('#sfx-open');
            }
        },

        setTheme(mode) {
            Kernel.data.theme = mode;
            Kernel.save();
            Kernel.applyTheme();
        },

        setWallpaper(wp) {
            Kernel.data.wallpaper = wp;
            Kernel.save();
            Kernel.applyWallpaper();
        },

        dragLogic() {
            let dragged = null, offX = 0, offY = 0;
            document.addEventListener('mousedown', e => {
                const titlebar = e.target.closest('.titlebar');
                if (titlebar) {
                    const win = titlebar.parentElement;
                    this.focusWin(win);
                    dragged = win;
                    const rect = win.getBoundingClientRect();
                    offX = e.clientX - rect.left;
                    offY = e.clientY - rect.top;
                } else if (!e.target.closest('.start-menu') && !e.target.closest('.start-btn')) {
                    $('#start-menu').style.display = 'none';
                }
            });
            document.addEventListener('mousemove', e => {
                if (dragged) {
                    dragged.style.left = (e.clientX - offX) + 'px';
                    dragged.style.top = (e.clientY - offY) + 'px';
                }
            });
            document.addEventListener('mouseup', () => dragged = null);
        }
    };

    /* --- APP LOGICS --- */

    // 1. NOTES & DREAMS (Persistence)
    $('#notes-area').value = localStorage.getItem('theoos-notes') || ''; // Usando chave antiga para compatibilidade
    $('#notes-area').oninput = (e) => localStorage.setItem('theoos-notes', e.target.value);
    $('#dreams-area').value = localStorage.getItem('theo_dreams') || '';
    $('#dreams-area').oninput = (e) => localStorage.setItem('theo_dreams', e.target.value);

    // 2. GALLERY
    const GalleryApp = {
        render() {
            const grid = $('#gallery-grid');
            grid.innerHTML = '';
            Kernel.data.photos.forEach(src => {
                const div = document.createElement('div');
                div.className = 'gallery-item';
                div.innerHTML = `<img src="${src}">`;
                grid.appendChild(div);
            });
        },
        add(file) {
            const reader = new FileReader();
            reader.onload = e => {
                Kernel.data.photos.push(e.target.result);
                Kernel.save();
                this.render();
            };
            reader.readAsDataURL(file);
        }
    };
    $('#img-upload').onchange = (e) => { if(e.target.files[0]) GalleryApp.add(e.target.files[0]); };

    // 3. PAINT
    const PaintApp = {
        ctx: null, color: '#00b894',
        init() {
            const cvs = $('#paint-canvas');
            this.ctx = cvs.getContext('2d');
            this.ctx.lineCap = 'round';
            this.ctx.lineWidth = 4;
            let drawing = false;
            
            const colors = ['#2d3436', '#00b894', '#0984e3', '#e84393', '#fdcb6e', '#636e72'];
            const pal = $('#paint-colors');
            if(pal.innerHTML === '') {
                colors.forEach(c => {
                    const sw = document.createElement('div');
                    sw.className = 'color-swatch';
                    sw.style.backgroundColor = c;
                    sw.onclick = () => { 
                        this.color = c; 
                        $$('.color-swatch').forEach(s => s.classList.remove('active'));
                        sw.classList.add('active');
                    };
                    pal.appendChild(sw);
                });
            }

            cvs.onmousedown = (e) => { drawing = true; this.ctx.beginPath(); this.ctx.moveTo(e.offsetX, e.offsetY); };
            cvs.onmousemove = (e) => {
                if(!drawing) return;
                this.ctx.strokeStyle = this.color;
                this.ctx.lineTo(e.offsetX, e.offsetY);
                this.ctx.stroke();
            };
            cvs.onmouseup = () => drawing = false;
        }
    };
    window.clearPaint = () => { const c=$('#paint-canvas'); c.getContext('2d').clearRect(0,0,c.width,c.height); };

    // 4. CALCULATOR
    const CalcApp = {
        init() {
            const keys = ['C','/','*','Back','7','8','9','-','4','5','6','+','1','2','3','=','0','.'];
            const board = $('#calc-keys');
            if(board.children.length > 1) return;
            keys.forEach(k => {
                const btn = document.createElement('button');
                btn.className = `calc-btn ${['/','*','-','+'].includes(k) ? 'op' : ''} ${k==='='?'eq':''}`;
                btn.innerText = k;
                if(k==='=') btn.style.gridColumn = 'span 2';
                if(k==='0') btn.style.gridColumn = 'span 2';
                btn.onclick = () => { playSound('#sfx-click'); this.press(k); };
                board.appendChild(btn);
            });
        },
        press(k) {
            const d = $('#calc-disp');
            if(k === 'C') d.innerText = '0';
            else if(k === 'Back') d.innerText = d.innerText.slice(0,-1) || '0';
            else if(k === '=') { try { d.innerText = eval(d.innerText); } catch { d.innerText = 'Err'; } }
            else d.innerText = d.innerText === '0' ? k : d.innerText + k;
        }
    };

    // 5. GAME (Fixed)
    const GameApp = {
        score: 0, timer: null,
        start() {
            this.score = 0; $('#game-score').innerText = 0;
            if(this.timer) clearInterval(this.timer);
            this.timer = setInterval(() => this.spawn(), 800);
        },
        stop() { clearInterval(this.timer); $('#game-area').innerHTML=''; },
        spawn() {
            const h = document.createElement('div');
            h.innerText = '‚ù§Ô∏è';
            h.className = 'game-heart';
            h.style.left = (Math.random() * 90) + '%';
            h.onmousedown = (e) => { 
                e.stopPropagation(); 
                this.score++; 
                $('#game-score').innerText = this.score; 
                h.remove(); 
            };
            $('#game-area').appendChild(h);
            setTimeout(() => { if(h.parentElement) h.remove(); }, 3000);
        },
        clickBg() { /* miss click? */ }
    };

    // 6. ADVENTURE (RESTORED ORIGINAL)
    const AdvApp = {
        story: {
            start: { text: "Voc√™ e Theo encontram uma clareira m√°gica. No centro, uma fonte sussurra melodias. √Ä direita, uma trilha brilha com poeira de estrelas. O que fazer?", choices: [{ text: "Beber da fonte", next: "fonte" }, { text: "Seguir a trilha", next: "trilha" }] },
            fonte: { text: "Ao beberem a √°gua, voc√™s come√ßam a flutuar! No c√©u, uma nuvem em formato de cora√ß√£o acena.", choices: [{ text: "Flutuar at√© a nuvem", next: "nuvem" }, { text: "Tentar voltar ao ch√£o", next: "chao" }] },
            trilha: { text: "A trilha leva a uma √°rvore gigante com uma porta com ma√ßaneta de biscoito.", choices: [{ text: "Girar a ma√ßaneta", next: "porta" }, { text: "Comer a ma√ßaneta!", next: "comer_macaneta" }] },
            nuvem: { text: "A nuvem √© de algod√£o-doce! √â o piquenique mais fofo de todos. (Final Feliz ‚òÅÔ∏è)", choices: [{ text: "Recome√ßar", next: "start" }] },
            chao: { text: "Voc√™s voltam ao ch√£o e agora podem falar com animais. Um coelho os convida para um ch√°.", choices: [{ text: "Aceitar", next: "cha_coelho" }, { text: "Recusar", next: "start" }] },
            cha_coelho: { text: "A festa do ch√° √© maravilhosa, com bolos de cenoura e risadas. (Final Amig√°vel üê∞)", choices: [{ text: "Recome√ßar", next: "start" }] },
            porta: { text: "A porta se abre para uma biblioteca aconchegante dentro da √°rvore. (Final Aconchegante üìö)", choices: [{ text: "Recome√ßar", next: "start" }] },
            comer_macaneta: { text: "A ma√ßaneta √© deliciosa, mas a porta some! Oops. (Fim Engra√ßado üç™)", choices: [{ text: "Recome√ßar", next: "start" }] }
        },
        render(sceneKey) {
            const scene = this.story[sceneKey]; if(!scene) return;
            $('#adv-text').innerText = scene.text;
            $('#adv-opts').innerHTML = '';
            scene.choices.forEach(o => {
                const btn = document.createElement('button');
                btn.className = 'btn';
                btn.innerText = o.text;
                btn.onclick = () => { playSound('#sfx-click'); this.render(o.next); };
                $('#adv-opts').appendChild(btn);
            });
        }
    };

    // 7. MUSIC (RESTORED PLAYLIST)
    const MusicApp = {
        audio: $('#bgMusicPlayer'),
        playlist: [
            { name: "M√∫sica Fofa 1", src: "musga_1.mp3" },
            { name: "M√∫sica Fofa 2", src: "musga_2.mp3" }
        ],
        idx: 0,
        isPlaying: false,

        init() {
            // Tenta carregar a primeira musica se existir
            this.loadTrack(0);
            this.audio.onended = () => this.next();
        },
        
        loadTrack(i) {
            this.idx = i;
            this.audio.src = this.playlist[i].src;
            $('#music-status').innerText = this.playlist[i].name;
        },

        startBackground() {
            this.loadTrack(0);
            this.audio.volume = 0.3; // Volume baixo para background
            this.audio.play().catch(e => console.log("Erro ao iniciar m√∫sica de fundo"));
            this.isPlaying = true;
        },

        playPause() {
            if(this.audio.paused) { 
                this.audio.play().catch(e => console.log("Audio file missing?")); 
                this.isPlaying = true;
            } else { 
                this.audio.pause(); 
                this.isPlaying = false;
            }
        },
        
        next() {
            let nextIdx = (this.idx + 1) % this.playlist.length;
            this.loadTrack(nextIdx);
            if(this.isPlaying) this.audio.play();
        },
        
        prev() {
            let prevIdx = (this.idx - 1 + this.playlist.length) % this.playlist.length;
            this.loadTrack(prevIdx);
            if(this.isPlaying) this.audio.play();
        },

        add(file) {
            const url = URL.createObjectURL(file);
            this.playlist.push({ name: file.name, src: url });
            // Se for a unica, carrega
            if(this.playlist.length === 3) { // 2 defaults + 1 new
                this.loadTrack(2);
                this.audio.play();
            }
        }
    };
    $('#music-upload').onchange = (e) => { 
        for(let f of e.target.files) MusicApp.add(f); 
    };
    MusicApp.init(); // Setup defaults

    // 8. ORACLE
    const OracleApp = {
        answers: ["Sim, com certeza!", "Talvez num sonho.", "Os astros dizem que sim.", "Pergunte mais tarde.", "Ame a si mesmo primeiro."],
        ask() {
            $('#oracle-res').innerText = this.answers[Math.floor(Math.random()*this.answers.length)];
        }
    };

    // 9. REMINDER (RESTORED ORIGINAL)
    const ReminderApp = {
        msgs: ["Lembrete: Voc√™ √© meu lugar favorito. üíñ", "N√£o se esque√ßa do qu√£o incr√≠vel voc√™ √©!", "Um abra√ßo seu cura tudo. ‚ú®", "Voc√™ tem o sorriso mais lindo.", "Sou sua f√£ n√∫mero 1!"],
        new() { $('#reminder-txt').innerText = this.msgs[Math.floor(Math.random()*this.msgs.length)]; }
    };

    // 10. TERMINAL (RESTORED ORIGINAL)
    $('#term-in').onkeydown = (e) => {
        if(e.key === 'Enter') {
            const val = e.target.value.toLowerCase().trim();
            const out = $('#term-out');
            
            const print = (txt) => {
                 out.innerHTML += `<div>${txt}</div>`;
                 out.scrollTop = out.scrollHeight;
            }
            
            print(`<span class="prompt">theo@amor:~$</span> ${val}`);
            
            if(val === 'ajuda') print("Comandos: ajuda, oi, data, amor, limpar");
            else if(val === 'limpar') out.innerHTML = '';
            else if(val === 'data') print(new Date().toLocaleString('pt-BR'));
            else if(val === 'amor') print("Amor = 100%.");
            else if(val === 'oi') print("Oi, Theo! üíñ");
            else print('Comando n√£o encontrado.');
            
            e.target.value = '';
        }
    };

    /* --- BOOTSTRAP --- */
    window.closeWin = UI.closeWin.bind(UI); 
    window.Boot = Boot; 

    // Login Logic
    $('#heart-btn').onclick = () => { $('#pass-input').focus(); };
    $('#login-form').onsubmit = (e) => {
        e.preventDefault();
        const p = $('#pass-input').value.toLowerCase();
        if(p === 'theo' || p === '') {
            $('#login-ritual').style.opacity = 0;
            setTimeout(() => { $('#login-ritual').style.display='none'; $('#desktop').style.display='block'; }, 800);
            playSound('#sfx-click');
            MusicApp.startBackground(); // Assegura que a m√∫sica toque ap√≥s o login
        } else {
            $('#login-msg').innerText = 'Senha errada... Tente "theo"';
            $('#login-msg').style.color = '#ff7675';
        }
    };

    // Init
    Kernel.init();
    UI.init();

  </script>
</body>
</html>