<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>TheoOS XP (pastel)</title>
  <style>
    :root{
      --xp-blue: #b3d4ff; /* pastel */
      --xp-green: #c7f4c2;
      --xp-yellow: #ffe8a3;
      --xp-pink: #ffd3e2;
      --xp-lilac: #e6d9ff;
      --xp-sky: #d7f3ff;
      --text: #3a3a3a;
      --shadow: rgba(0,0,0,.12);
      --glass: rgba(255,255,255,.65);
      --titlebar: linear-gradient(180deg, #cfe6ff, #b8d8ff);
      --titlebar-focus: linear-gradient(180deg, #ffd6e8, #ffc2dc);
      --taskbar: #cae6ff;
      --taskbar-line: #b9d7ff;
    }
    *{box-sizing:border-box;font-family: "Trebuchet MS", system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif}
    body,html{height:100%;margin:0;background:#9ed3ff;overflow:hidden;color:var(--text)}
    
    /* --- NOVAS SEÇÕES --- */
    #pre-boot{
      position:fixed;
      inset:0;
      background: #000;
      z-index: 200;
      display: grid;
      place-items: center;
    }
    #initButton{
      font-size: 1.2rem;
      padding: 14px 28px;
      border-radius: 12px;
      border: 1px solid #444;
      background: #222;
      color: #fff;
      cursor: pointer;
      transition: background .2s;
    }
    #initButton:hover{
      background: #333;
    }
    
    /* Bliss-like pastel wallpaper */
    .wallpaper{
      position:fixed;inset:0;overflow:hidden;
      background: radial-gradient(1200px 700px at 60% 110%, #b8f7c3 0%, #a8e9f0 55%, #c9d8ff 100%);
    }
    .cloud{position:absolute;filter:blur(2px);opacity:.35}
    .cloud::before{content:"";display:block;width:220px;height:90px;border-radius:60px;background:white;box-shadow:
      80px -20px 0 10px white,
      150px 0 0 0 white,
      40px 10px 0 -10px white;
    }

    /* Boot Screen */
    #bootScreen{
      position:fixed;inset:0;background:black;z-index:100;display:none;place-items:center;
    }
    #bootVideo{
      width:100%;height:100%;object-fit:cover;
    }

    /* Login */
    #login{
      position:fixed;inset:0;display:none;place-items:center;z-index:5;
      backdrop-filter:saturate(1.2);
    }
    .login-card{
      width:min(92vw, 420px);
      background:var(--glass);box-shadow:0 20px 50px var(--shadow);border-radius:18px;padding:22px;
      border:1px solid rgba(255,255,255,.8)
    }
    .login-title{display:flex;gap:12px;align-items:center;margin-bottom:14px}
    .login-title .logo{width:42px;height:42px;border-radius:10px;background:linear-gradient(135deg, var(--xp-blue), var(--xp-pink));display:grid;place-items:center;box-shadow:0 4px 12px var(--shadow)}
    .login-title h1{font-size:1.3rem;margin:0}
    .login-form label{font-size:.9rem;opacity:.8}
    .login-form input{width:100%;padding:12px 14px;border-radius:12px;border:1px solid #dfe9ff;margin-top:6px}
    .login-actions{display:flex;gap:10px;align-items:center;margin-top:14px}
    .btn{appearance:none;border:0;border-radius:12px;padding:10px 14px;cursor:pointer;box-shadow:0 6px 18px var(--shadow);font-weight:700}
    .btn-primary{background:linear-gradient(180deg, #ffd3e2, #ffc2dc);}
    .btn-ghost{background:white}
    .hint{font-size:.8rem;opacity:.7;margin-top:6px}

    /* Desktop */
    #desktop{position:fixed;inset:0;display:none}
    .icons{position:absolute;inset:0; padding:14px; display:grid; grid-template-columns: repeat(auto-fill, 92px); align-content:start; gap:18px}
    .icon{width:86px;display:flex;flex-direction:column;align-items:center;gap:6px;user-select:none;cursor:pointer}
    .icon:active{transform:translateY(1px)}
    .icon .badge{font-size:11px;padding:4px 8px;border-radius:9px;background:rgba(255,255,255,.7);box-shadow:0 2px 8px var(--shadow)}
    .icon svg{width:48px;height:48px;filter:drop-shadow(0 4px 6px var(--shadow))}

    /* Taskbar */
    .taskbar{position:absolute;left:0;right:0;bottom:0;height:42px;background:var(--taskbar);border-top:1px solid var(--taskbar-line);display:flex;align-items:center;gap:10px;padding:0 8px}
    .start{display:flex;align-items:center;gap:8px;padding:8px 12px;border-radius:14px;background:white;box-shadow:0 6px 14px var(--shadow);cursor:pointer;font-weight:700}
    .start svg{width:16px;height:16px}
    .tray{margin-left:auto;display:flex;align-items:center;gap:10px}
    .clock{font-variant-numeric:tabular-nums;background:white;border-radius:10px;padding:6px 10px;box-shadow:0 6px 14px var(--shadow)}

    /* Windows */
    .window{position:absolute;min-width:320px;min-height:220px;background:#fff;border-radius:14px;box-shadow:0 18px 50px var(--shadow);border:1px solid #e9f0ff;overflow:hidden}
    .titlebar{height:36px;display:flex;align-items:center;gap:8px;padding:0 10px;background:var(--titlebar);cursor:move;border-bottom:1px solid #d7e7ff}
    .window.focus .titlebar{background:var(--titlebar-focus)}
    .titlebar .dots{display:flex;gap:6px;margin-right:6px}
    .dot{width:10px;height:10px;border-radius:50%}
    .dot.red{background:#ff8aa0}
    .dot.yellow{background:#ffd47a}
    .dot.green{background:#9be69b}
    .title{font-weight:700}
    .win-content{padding:12px; height: calc(100% - 36px); overflow:auto}
    .win-actions{margin-left:auto;display:flex;gap:6px}
    .win-btn{border:0;background:white;border-radius:8px;padding:4px 8px;cursor:pointer}

    /* Apps */
    .notes textarea{width:100%;height:240px;border:1px solid #eaeaea;border-radius:10px;padding:10px}
    .gallery{display:grid;grid-template-columns:repeat(auto-fill,minmax(120px,1fr));gap:10px}
    .gallery img{width:100%;aspect-ratio:1;border-radius:12px;object-fit:cover;box-shadow:0 6px 16px var(--shadow)}
    .term{background:#0b1020;color:#e5e7ff;border-radius:10px;padding:10px;font-family:ui-monospace, SFMono-Regular, Menlo, Consolas, monospace;height:260px;overflow:auto}
    .term .prompt{color:#a0d6ff}
    .term input{width:100%;background:transparent;border:0;color:#fff;outline:none}
    .achievements{display:grid;gap:10px}
    .ach{display:flex;align-items:center;gap:10px;background:var(--xp-lilac);padding:10px;border-radius:12px}

    /* Start menu (cute) */
    .start-menu{position:absolute;left:8px;bottom:46px;width:280px;background:white;border:1px solid #e3eeff;border-radius:14px;box-shadow:0 18px 50px var(--shadow);display:none;overflow:hidden}
    .start-head{background:linear-gradient(180deg,#e9f3ff,#d5e9ff);padding:10px;font-weight:700}
    .start-list{padding:8px;display:grid;gap:6px}
    .start-item{display:flex;align-items:center;gap:10px;padding:8px;border-radius:10px;cursor:pointer}
    .start-item:hover{background:#f6faff}

    /* Secret modal */
    .modal{position:fixed;inset:0;display:none;place-items:center;background:rgba(0,0,0,.25)}
    .modal-card{width:min(92vw,520px);background:white;border-radius:18px;padding:18px;box-shadow:0 20px 60px var(--shadow)}

    @media (max-width: 600px){
      .window{min-width: 88vw; left:6vw !important; right:6vw !important}
      .icons{grid-template-columns: repeat(3, 1fr)}
    }
  </style>
</head>
<body>
  <section id="pre-boot">
    <button id="initButton">✨ Inicializar TheoOS ✨</button>
  </section>

  <section id="bootScreen">
    <video id="bootVideo" src="boot.mp4" playsinline></video>
  </section>

  <div class="wallpaper" id="wall">
    <div class="cloud" style="top:12%;left:8%"></div>
    <div class="cloud" style="top:24%;left:42%;transform:scale(1.2)"></div>
    <div class="cloud" style="top:54%;left:18%;transform:scale(1.1)"></div>
    <div class="cloud" style="top:66%;left:68%;transform:scale(0.9)"></div>
  </div>

  <section id="login">
    <div class="login-card">
      <div class="login-title">
        <div class="logo" aria-hidden="true">💻</div>
        <h1>TheoOS XP — sessão de usuário</h1>
      </div>
      <form class="login-form" id="loginForm">
        <label for="user">Usuário</label>
        <input id="user" value="Theo" required />
        <div style="height:8px"></div>
        <label for="pass">Senha</label>
        <input id="pass" type="password" placeholder="dica: theo" />
        <div class="login-actions">
          <button class="btn btn-primary" type="submit">Entrar</button>
          <button class="btn btn-ghost" type="button" id="guest">Entrar como convidado</button>
        </div>
        <div class="hint">Bem-vindo, Theo ✨ Hoje é um bom dia para ser amado.</div>
      </form>
    </div>
  </section>

  <section id="desktop" aria-label="Área de trabalho">
    <div class="icons">
      <div class="icon" data-open="#win-notes" title="Minhas Cartas">
        <svg viewBox="0 0 24 24" fill="none"><rect x="3" y="4" width="18" height="16" rx="3" fill="#ffd3e2"/><path d="M4 7l8 6 8-6" stroke="#ff7aa5" stroke-width="1.6" stroke-linecap="round"/></svg>
        <div class="badge">Minhas Cartas</div>
      </div>
      <div class="icon" data-open="#win-gallery" title="Fotos Secretas">
        <svg viewBox="0 0 24 24" fill="none"><rect x="3" y="5" width="18" height="14" rx="3" fill="#bfe9ff"/><circle cx="9" cy="10" r="2" fill="#84c8ff"/><path d="M5 16l4-3 3 2 3-2 4 3" stroke="#3ba9ff" stroke-width="1.6" stroke-linecap="round"/></svg>
        <div class="badge">Fotos Secretas</div>
      </div>
      <div class="icon" data-open="#win-game" title="Jogo Surpresa">
        <svg viewBox="0 0 24 24" fill="none"><rect x="2" y="6" width="20" height="12" rx="6" fill="#c7f4c2"/><circle cx="9" cy="12" r="1.8" fill="#77d173"/><rect x="14" y="10.2" width="1.4" height="3.6" rx=".7" fill="#77d173"/><rect x="12.6" y="11.4" width="3.6" height="1.4" rx=".7" fill="#77d173"/></svg>
        <div class="badge">Jogo Surpresa</div>
      </div>
      <div class="icon" data-open="#win-terminal" title="Terminal Fofo">
        <svg viewBox="0 0 24 24" fill="none"><rect x="3" y="4" width="18" height="16" rx="3" fill="#e6d9ff"/><path d="M7 9l3 3-3 3" stroke="#9c79ff" stroke-width="1.6" stroke-linecap="round"/><path d="M12 15h5" stroke="#9c79ff" stroke-width="1.6" stroke-linecap="round"/></svg>
        <div class="badge">Terminal</div>
      </div>
      <div class="icon" data-open="#win-achv" title="Conquistas do Amor">
        <svg viewBox="0 0 24 24" fill="none"><path d="M12 3l2.2 4.5 5 .7-3.6 3.6.9 5-4.5-2.4-4.5 2.4.9-5L4.8 8.2l5-.7L12 3z" fill="#ffe8a3"/></svg>
        <div class="badge">Conquistas</div>
      </div>
    </div>

    <div class="taskbar">
      <div class="start" id="startBtn" title="Iniciar">
        <svg viewBox="0 0 24 24" fill="none"><path d="M4 12a8 8 0 1016 0A8 8 0 004 12zm4.5-1.5l7 3.5-7 3.5v-7z" fill="#ff80a8"/></svg>
        Iniciar ♡
      </div>
      <div class="tray">
        <div class="clock" id="clock">--:--</div>
      </div>
    </div>

    <div class="start-menu" id="startMenu">
      <div class="start-head">TheoOS XP — Menu Iniciar</div>
      <div class="start-list">
        <div class="start-item" data-open="#win-notes">💌 Minhas Cartas</div>
        <div class="start-item" data-open="#win-gallery">🖼️ Fotos Secretas</div>
        <div class="start-item" data-open="#win-game">🎮 Jogo Surpresa</div>
        <div class="start-item" data-open="#win-terminal">⌨️ Terminal</div>
        <div class="start-item" data-open="#win-achv">🏆 Conquistas</div>
      </div>
    </div>

    <div class="window" id="win-notes" style="left:10%;top:10%;width:520px;height:360px;display:none">
      <div class="titlebar"><div class="dots"><span class="dot red"></span><span class="dot yellow"></span><span class="dot green"></span></div><div class="title">Minhas Cartas</div><div class="win-actions"><button class="win-btn" data-close>Fechar</button></div></div>
      <div class="win-content notes">
        <p>Oi, Theo! 💗 Aqui vão algumas palavras só pra você. Edite ou escreva novas cartinhas:</p>
        <textarea id="notesArea">• Você é meu bug favorito (porque sempre quero reproduzir 🤭)
• Obrigado por existir, versão estável e versão beta.
• Hoje: 1 abraço longo obrigatório. 

Ass: quem te ama mais que café.</textarea>
        <div style="margin-top:8px;display:flex;gap:8px;align-items:center">
          <button class="btn btn-primary" id="saveNotes">Salvar</button>
          <span id="saveStatus" style="font-size:.85rem;opacity:.75"></span>
        </div>
      </div>
    </div>

    <div class="window" id="win-gallery" style="left:34%;top:12%;width:560px;height:380px;display:none">
      <div class="titlebar"><div class="dots"><span class="dot red"></span><span class="dot yellow"></span><span class="dot green"></span></div><div class="title">Fotos Secretas</div><div class="win-actions"><label class="win-btn" for="upPhoto">Adicionar</label><button class="win-btn" data-close>Fechar</button></div></div>
      <div class="win-content">
        <input type="file" id="upPhoto" accept="image/*" multiple style="display:none" />
        <div class="gallery" id="gallery">
          <img src="img_1.jpg" alt="Foto fofa 1">
          <img src="img_2.jpg" alt="Foto fofa 2">
          <img src="img_3.jpg" alt="Foto fofa 3">
        </div>
      </div>
    </div>

    <div class="window" id="win-terminal" style="left:18%;top:32%;width:520px;height:340px;display:none">
      <div class="titlebar"><div class="dots"><span class="dot red"></span><span class="dot yellow"></span><span class="dot green"></span></div><div class="title">Terminal Fofo</div><div class="win-actions"><button class="win-btn" data-close>Fechar</button></div></div>
      <div class="win-content">
        <div class="term" id="term">
          <div>Bem-vindo ao <b>TheoShell 1.0</b> — digite <span class="prompt">ajuda</span> para ver comandos.</div>
          <div class="prompt">theo@amor:~$</div>
          <input id="termInput" autocomplete="off" />
        </div>
      </div>
    </div>

    <div class="window" id="win-game" style="left:52%;top:28%;width:420px;height:320px;display:none">
      <div class="titlebar"><div class="dots"><span class="dot red"></span><span class="dot yellow"></span><span class="dot green"></span></div><div class="title">Jogo Surpresa: Colete Corações</div><div class="win-actions"><button class="win-btn" data-close>Fechar</button></div></div>
      <div class="win-content">
        <p>Click/tap nos corações que aparecem! Faça 10 pontos para liberar um segredo 💖</p>
        <div id="gameArea" style="position:relative;height:200px;background:var(--xp-sky);border-radius:12px;overflow:hidden"></div>
        <div style="margin-top:8px">Pontuação: <b id="score">0</b> / 10</div>
      </div>
    </div>

    <div class="window" id="win-achv" style="left:8%;top:58%;width:520px;height:300px;display:none">
      <div class="titlebar"><div class="dots"><span class="dot red"></span><span class="dot yellow"></span><span class="dot green"></span></div><div class="title">Conquistas do Amor</div><div class="win-actions"><button class="win-btn" data-close>Fechar</button></div></div>
      <div class="win-content achievements" id="achv">
        <div class="ach">🏅 Primeira risada do dia — +100 XP</div>
        <div class="ach">📸 Selfie que salvou a semana — +200 XP</div>
        <div class="ach">🫶 Abraço de 10 segundos — +300 XP</div>
      </div>
    </div>

    <div class="modal" id="secretModal">
      <div class="modal-card">
        <h2>Segredo desbloqueado ✨</h2>
        <p>Parabéns, Theo! Você ativou o <b>Modo Ultra Fofo</b>. Lembrete importante:
        você é meu lugar favorito do mundo inteiro. 💖</p>
        <button class="btn btn-primary" id="closeSecret">Fechar</button>
      </div>
    </div>
  </section>

  <audio id="startupSound" src="ini.mp3"></audio>
  <audio id="backgroundMusic" src="background.mp3" loop></audio>
  
  <script>
    // --- Simple helpers ---
    const $ = (sel, root=document) => root.querySelector(sel);
    const $$ = (sel, root=document) => Array.from(root.querySelectorAll(sel));

    /* --- LÓGICA DE INICIALIZAÇÃO MODIFICADA --- */

    // Referências aos elementos
    const preBoot = $('#pre-boot');
    const initButton = $('#initButton');
    const bootScreen = $('#bootScreen');
    const bootVideo = $('#bootVideo');
    const login = $('#login');
    const desktop = $('#desktop');
    const startupSound = $('#startupSound');
    const backgroundMusic = $('#backgroundMusic');

    // 1. Evento de clique no botão Inicializar
    initButton.addEventListener('click', () => {
      preBoot.style.display = 'none'; // Esconde a tela inicial
      bootScreen.style.display = 'grid'; // Mostra o boot
      
      // Ajusta o volume da música de fundo para 30%
      backgroundMusic.volume = 0.3;

      // Toca o vídeo de boot (com som, graças ao clique)
      bootVideo.play();
    });

    // 2. Quando o vídeo de boot terminar
    bootVideo.addEventListener('ended', () => {
      bootScreen.style.display = 'none'; // Esconde o boot
      login.style.display = 'grid'; // Mostra o login
      
      // Toca os outros sons, que agora são permitidos
      startupSound.play();
      backgroundMusic.play();
    });
    
    // 3. Quando o usuário fizer o login
    function startSystem() {
      login.style.display='none';
      desktop.style.display='block';
      
      // Garante que a música continue tocando caso tenha parado
      if (backgroundMusic.paused) {
        backgroundMusic.play();
      }

      localStorage.setItem('theoos-last-login', String(Date.now()));
    }

    /* --- LÓGICA ORIGINAL DO DESKTOP (SEM MUDANÇAS) --- */

    // Clock
    function updateClock(){
      const d = new Date();
      const hh = String(d.getHours()).padStart(2,'0');
      const mm = String(d.getMinutes()).padStart(2,'0');
      $('#clock').textContent = `${hh}:${mm}`;
    }
    setInterval(updateClock, 1000); updateClock();

    // Login
    const loginForm = $('#loginForm');
    loginForm.addEventListener('submit', (e)=>{
      e.preventDefault();
      const pass = $('#pass').value.trim().toLowerCase();
      if(pass && pass !== 'theo'){
        alert('Senha fofa incorreta. Dica: "theo"');
        return;
      }
      startSystem();
    });
    $('#guest').addEventListener('click', startSystem);

    // Start menu
    const startBtn = $('#startBtn');
    const startMenu = $('#startMenu');
    startBtn.addEventListener('click', ()=>{
      startMenu.style.display = startMenu.style.display==='block' ? 'none' : 'block';
    });
    document.addEventListener('click', (e)=>{
      if(!startMenu.contains(e.target) && e.target !== startBtn) startMenu.style.display='none';
    });

    // Open windows from icons / start menu
    function openWin(sel){
      const win = $(sel);
      if(!win) return;
      win.style.display='block';
      bringToFront(win);
    }
    $$('.icon').forEach(ic=> ic.addEventListener('dblclick', ()=> openWin(ic.dataset.open)) );
    $$('#startMenu .start-item').forEach(it=> it.addEventListener('click', ()=>{ openWin(it.dataset.open); startMenu.style.display='none'; }) );

    // Window controls
    const zBase = 10; let zTop = zBase;
    function bringToFront(win){
      $$('.window').forEach(w=>w.classList.remove('focus'));
      win.classList.add('focus');
      win.style.zIndex = ++zTop;
    }
    $$('.window').forEach(win=>{
      const bar = $('.titlebar', win);
      bar.addEventListener('mousedown', startDrag);
      win.addEventListener('mousedown', ()=> bringToFront(win));
      $('[data-close]', win).addEventListener('click', ()=> win.style.display='none');
    });

    // Drag logic
    let drag = null;
    function startDrag(e){
      const win = e.currentTarget.parentElement;
      bringToFront(win);
      const rect = win.getBoundingClientRect();
      drag = { win, offX: e.clientX - rect.left, offY: e.clientY - rect.top };
      document.addEventListener('mousemove', onDrag);
      document.addEventListener('mouseup', endDrag);
    }
    function onDrag(e){
      if(!drag) return;
      const x = Math.min(window.innerWidth - 80, Math.max(0, e.clientX - drag.offX));
      const y = Math.min(window.innerHeight - 100, Math.max(0, e.clientY - drag.offY));
      drag.win.style.left = x + 'px';
      drag.win.style.top = y + 'px';
    }
    function endDrag(){
      document.removeEventListener('mousemove', onDrag);
      document.removeEventListener('mouseup', endDrag);
      drag = null;
    }

    // Notes save
    const notesArea = $('#notesArea');
    const saveBtn = $('#saveNotes');
    const saveStatus = $('#saveStatus');
    notesArea.value = localStorage.getItem('theoos-notes') || notesArea.value;
    saveBtn.addEventListener('click', ()=>{
      localStorage.setItem('theoos-notes', notesArea.value);
      saveStatus.textContent = 'Salvo ✓';
      setTimeout(()=> saveStatus.textContent = '', 1500);
    });

    // Gallery upload
    const upPhoto = $('#upPhoto');
    const gallery = $('#gallery');
    upPhoto.addEventListener('change', ()=>{
      Array.from(upPhoto.files).forEach(file=>{
        const reader = new FileReader();
        reader.onload = ()=>{
          const img = new Image();
          img.src = reader.result;
          img.alt = 'Theo & você';
          gallery.appendChild(img);
          persistGallery();
        };
        reader.readAsDataURL(file);
      });
    });
    function persistGallery(){
      const imgs = $$('#gallery img').map(i=> i.src);
      localStorage.setItem('theoos-gallery', JSON.stringify(imgs));
    }
    function loadGallery(){
      try{ const data = JSON.parse(localStorage.getItem('theoos-gallery')||'[]');
        if(data.length){ gallery.innerHTML=''; data.forEach(src=>{ const img=new Image(); img.src=src; img.alt='Theo & você'; gallery.appendChild(img); }); }
      }catch{}
    }
    loadGallery();

    // Terminal cute
    const term = $('#term');
    const termInput = $('#termInput');
    const commands = {
      ajuda(){
        print("Comandos: ajuda, oi, data, amor, limpar, segredo");
      },
      oi(){ print("Oi, Theo! Você é meu bug preferido a ser mantido para sempre."); },
      data(){ print(new Date().toString()); },
      amor(){ print("Resposta do sistema: Amor = 100%. Constante imutável."); },
      limpar(){ term.querySelectorAll('div').forEach((d,i)=>{ if(i>0) d.remove(); }); },
      segredo(){ unlockSecret(); }
    };
    function print(txt){
      const line = document.createElement('div');
      line.textContent = txt;
      term.insertBefore(line, termInput.parentElement);
      term.scrollTop = term.scrollHeight;
    }
    termInput.addEventListener('keydown',(e)=>{
      if(e.key==='Enter'){
        const val = termInput.value.trim().toLowerCase();
        const prompt = document.createElement('div');
        prompt.innerHTML = `<span class="prompt">theo@amor:~$</span> ${val}`;
        term.insertBefore(prompt, termInput.parentElement);
        termInput.value='';
        if(commands[val]) commands[val](); else print('Comando não encontrado. Tente "ajuda".');
      }
    });

    // Mini game hearts
    const gameArea = $('#gameArea');
    let score = 0;
    function spawnHeart(){
      const h = document.createElement('div');
      h.textContent = '💗';
      h.style.position='absolute';
      h.style.left = Math.random()* (gameArea.clientWidth - 24) + 'px';
      h.style.top = Math.random()* (gameArea.clientHeight - 24) + 'px';
      h.style.fontSize = (Math.random()*24 + 18) + 'px';
      h.style.userSelect='none';
      h.style.cursor='pointer';
      h.addEventListener('click', ()=>{ score++; $('#score').textContent = score; h.remove(); if(score>=10){ unlockSecret(); } });
      gameArea.appendChild(h);
      setTimeout(()=> h.remove(), 1800);
    }
    setInterval(()=>{ if($('#win-game').style.display==='block') spawnHeart(); }, 600);

    // Secret triggers
    const secretModal = $('#secretModal');
    $('#closeSecret').addEventListener('click', ()=> secretModal.style.display='none');
    function unlockSecret(){
      secretModal.style.display='grid';
    }
    // wallpaper easter egg: 5 double-clicks
    let dbl = 0; $('#wall').addEventListener('dblclick', ()=>{ dbl++; if(dbl>=5){ dbl=0; unlockSecret(); } });

    // Focus windows when opened
    $$('.window').forEach(win=>{ win.addEventListener('mousedown', ()=> bringToFront(win)); });

    // Open a welcome note on first load after login
    function welcome(){
      openWin('#win-notes');
      bringToFront($('#win-notes'));
    }
    // Optional auto-welcome when desktop first shows
    const observer = new MutationObserver(()=>{
      if(desktop.style.display==='block'){ welcome(); observer.disconnect(); }
    });
    observer.observe(desktop,{attributes:true});
  </script>
</body>
</html>
